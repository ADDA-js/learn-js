some working code! second try. changes to upstream
